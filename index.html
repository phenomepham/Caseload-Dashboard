<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WIOA Youth Caseload Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Inter font + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind = window.tailwind || {};
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      },
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 UMD + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-950 font-sans text-slate-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const STORAGE_KEY = "wioa_youth_caseload_v1";

    function loadCaseload() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveCaseload(cases) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cases));
    }

    function makeId(prefix = "id") {
      if (typeof crypto !== "undefined" && crypto.randomUUID) return crypto.randomUUID();
      return `${prefix}-${Math.random().toString(36).slice(2, 10)}`;
    }

    function daysSince(dateStr) {
      if (!dateStr) return null;
      const d = new Date(dateStr);
      if (Number.isNaN(d.getTime())) return null;
      const today = new Date();
      const diffMs = today - d;
      return Math.floor(diffMs / (1000 * 60 * 60 * 24));
    }

    function inactivityStatus(lastContactDate, enrollmentDate) {
      const baseDate = lastContactDate || enrollmentDate;
      const days = daysSince(baseDate);
      if (days === null) return { label: "No contact recorded", color: "bg-slate-700 text-slate-100 border-slate-600", level: "none", days: null };

      if (days >= 90) {
        return {
          label: `${days} days since last contact • 90+ days INACTIVE`,
          color: "bg-red-500/20 text-red-200 border-red-500/70",
          level: "critical",
          days,
        };
      }
      if (days >= 60) {
        return {
          label: `${days} days since last contact • approaching 90 days`,
          color: "bg-amber-500/15 text-amber-200 border-amber-400/70",
          level: "high",
          days,
        };
      }
      if (days >= 30) {
        return {
          label: `${days} days since last contact • contact needed this month`,
          color: "bg-yellow-500/15 text-yellow-100 border-yellow-400/70",
          level: "medium",
          days,
        };
      }
      return {
        label: `${days} days since last contact • active`,
        color: "bg-emerald-500/15 text-emerald-200 border-emerald-400/70",
        level: "low",
        days,
      };
    }

    const STATUS_OPTIONS = [
      { value: "Pending", label: "Pending", color: "bg-sky-500/15 text-sky-200 border-sky-400/60" },
      { value: "Completed", label: "Completed", color: "bg-emerald-500/15 text-emerald-200 border-emerald-400/70" },
      { value: "Unsuccessful", label: "Unsuccessful", color: "bg-rose-500/15 text-rose-200 border-rose-400/70" },
    ];

    function App() {
      const [cases, setCases] = useState([]);
      const [selectedId, setSelectedId] = useState(null);
      const [search, setSearch] = useState("");

      const [newCase, setNewCase] = useState({
        name: "",
        sid: "",
        enrollmentDate: "",
        lastContactDate: "",
      });

      const [newActivity, setNewActivity] = useState({
        label: "",
        status: "Pending",
        date: "",
        notes: "",
      });

      const [message, setMessage] = useState("");

      useEffect(() => {
        const loaded = loadCaseload();
        setCases(loaded);
        if (loaded.length > 0) setSelectedId(loaded[0].id);
      }, []);

      useEffect(() => {
        saveCaseload(cases);
      }, [cases]);

      const selectedCase = useMemo(
        () => cases.find(c => c.id === selectedId) || null,
        [cases, selectedId]
      );

      const filteredCases = useMemo(() => {
        const q = search.toLowerCase().trim();
        if (!q) return cases;
        return cases.filter(c =>
          (c.name || "").toLowerCase().includes(q) ||
          (c.sid || "").toLowerCase().includes(q)
        );
      }, [cases, search]);

      function addCase() {
        if (!newCase.name.trim()) {
          setMessage("Please enter at least a participant name.");
          return;
        }
        const c = {
          id: makeId("case"),
          name: newCase.name.trim(),
          sid: newCase.sid.trim(),
          enrollmentDate: newCase.enrollmentDate || "",
          lastContactDate: newCase.lastContactDate || "",
          activities: [],
        };
        const next = [...cases, c];
        setCases(next);
        setSelectedId(c.id);
        setNewCase({ name: "", sid: "", enrollmentDate: "", lastContactDate: "" });
        setMessage("Participant added to caseload.");
      }

      function updateSelectedCase(field, value) {
        if (!selectedCase) return;
        setCases(prev =>
          prev.map(c => (c.id === selectedCase.id ? { ...c, [field]: value } : c))
        );
      }

      function deleteSelectedCase() {
        if (!selectedCase) return;
        if (!confirm(`Remove ${selectedCase.name || "this participant"} from caseload?`)) return;
        const next = cases.filter(c => c.id !== selectedCase.id);
        setCases(next);
        setSelectedId(next[0]?.id || null);
      }

      function addActivity() {
        if (!selectedCase) {
          setMessage("Select a participant before adding an activity.");
          return;
        }
        if (!newActivity.label.trim()) {
          setMessage("Activity needs a label/name.");
          return;
        }
        const act = {
          id: makeId("act"),
          label: newActivity.label.trim(),
          status: newActivity.status,
          date: newActivity.date || "",
          notes: newActivity.notes || "",
        };
        setCases(prev =>
          prev.map(c =>
            c.id === selectedCase.id
              ? { ...c, activities: [...(c.activities || []), act] }
              : c
          )
        );
        if (newActivity.date) {
          updateSelectedCase("lastContactDate", newActivity.date);
        }
        setNewActivity({ label: "", status: "Pending", date: "", notes: "" });
        setMessage("Activity added.");
      }

      function updateActivity(actId, updates) {
        if (!selectedCase) return;
        setCases(prev =>
          prev.map(c =>
            c.id === selectedCase.id
              ? {
                  ...c,
                  activities: (c.activities || []).map(a =>
                    a.id === actId ? { ...a, ...updates } : a
                  ),
                }
              : c
          )
        );
      }

      function deleteActivity(actId) {
        if (!selectedCase) return;
        setCases(prev =>
          prev.map(c =>
            c.id === selectedCase.id
              ? {
                  ...c,
                  activities: (c.activities || []).filter(a => a.id !== actId),
                }
              : c
          )
        );
      }

      const todayStr = new Date().toISOString().slice(0, 10);

      return (
        <div className="min-h-screen px-3 py-4 md:px-6 md:py-6">
          <div className="max-w-6xl mx-auto bg-slate-900/80 border border-slate-800 rounded-3xl shadow-2xl p-4 md:p-6 lg:p-8">
            {/* Header */}
            <div className="flex flex-wrap items-center justify-between gap-4 mb-6">
              <div>
                <div className="inline-flex items-center gap-2 mb-1">
                  <span className="inline-flex items-center rounded-full bg-emerald-500/10 text-emerald-300 border border-emerald-500/40 px-2 py-0.5 text-[10px] uppercase tracking-wide">
                    WIOA Youth
                  </span>
                  <span className="text-[11px] text-slate-400">Caseload Dashboard</span>
                </div>
                <h1 className="text-2xl font-bold tracking-tight">Caseload Activity & Inactivity Monitor</h1>
                <p className="text-sm text-slate-400 mt-1">
                  Track monthly contacts, key activities, and 90-day inactivity risk across your caseload.
                </p>
              </div>
              <div className="text-xs text-slate-400 text-right max-w-xs">
                Today: <span className="text-slate-200 font-medium">{todayStr}</span>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-5">
              {/* Left: caseload list + add */}
              <div className="space-y-4 lg:col-span-1">
                <div className="bg-slate-950/70 border border-slate-800 rounded-2xl p-4 space-y-3">
                  <div className="flex items-center justify-between gap-2 mb-1">
                    <div className="text-xs font-semibold text-slate-200 uppercase tracking-wide">
                      Caseload
                    </div>
                    <span className="text-[11px] text-slate-400">
                      Total: <span className="text-emerald-300 font-semibold">{cases.length}</span>
                    </span>
                  </div>
                  <input
                    className="w-full h-8 px-3 rounded-lg border border-slate-700 bg-slate-900 text-slate-100 text-xs placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/60"
                    placeholder="Search by name or SID..."
                    value={search}
                    onChange={e => setSearch(e.target.value)}
                  />
                  <div className="max-h-72 overflow-auto space-y-1 mt-2">
                    {filteredCases.length === 0 && (
                      <div className="text-[11px] text-slate-500">
                        No participants yet. Add one below.
                      </div>
                    )}
                    {filteredCases.map(c => {
                      const status = inactivityStatus(c.lastContactDate, c.enrollmentDate);
                      const isSelected = c.id === selectedId;
                      return (
                        <button
                          key={c.id}
                          onClick={() => setSelectedId(c.id)}
                          className={`w-full text-left text-xs rounded-xl border px-3 py-2 transition-colors ${
                            isSelected
                              ? "border-emerald-400/70 bg-slate-900"
                              : "border-slate-700 bg-slate-950 hover:border-emerald-400/70"
                          }`}
                        >
                          <div className="flex items-center justify-between gap-2">
                            <div>
                              <div className="font-semibold text-slate-100 truncate">
                                {c.name || "(no name)"}
                              </div>
                              <div className="text-[11px] text-slate-400">
                                SID: {c.sid || "—"}
                              </div>
                              <div className="text-[10px] text-slate-500">
                                Enrolled: {c.enrollmentDate || "—"}
                              </div>
                            </div>
                          </div>
                          <div
                            className={`mt-1 inline-flex items-center px-2 py-0.5 rounded-full border text-[10px] ${status.color}`}
                          >
                            {status.label}
                          </div>
                        </button>
                      );
                    })}
                  </div>
                </div>

                <div className="bg-slate-950/70 border border-slate-800 rounded-2xl p-4 space-y-3">
                  <div className="text-xs font-semibold text-slate-200 uppercase tracking-wide mb-1">
                    Add Participant
                  </div>
                  <div className="space-y-2">
                    <input
                      className="w-full h-8 px-3 rounded-lg border border-slate-700 bg-slate-900 text-slate-100 text-xs focus:outline-none focus:ring-2 focus:ring-emerald-500/60"
                      placeholder="Name"
                      value={newCase.name}
                      onChange={e => setNewCase({ ...newCase, name: e.target.value })}
                    />
                    <input
                      className="w-full h-8 px-3 rounded-lg border border-slate-700 bg-slate-900 text-slate-100 text-xs focus:outline-none focus:ring-2 focus:ring-emerald-500/60"
                      placeholder="SID / Case ID"
                      value={newCase.sid}
                      onChange={e => setNewCase({ ...newCase, sid: e.target.value })}
                    />
                    <div className="grid grid-cols-2 gap-2">
                      <div>
                        <label className="text-[10px] text-slate-300">Enrollment date</label>
                        <input
                          type="date"
                          className="w-full h-8 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100 text-xs"
                          value={newCase.enrollmentDate}
                          onChange={e => setNewCase({ ...newCase, enrollmentDate: e.target.value })}
                        />
                      </div>
                      <div>
                        <label className="text-[10px] text-slate-300">Last contact (optional)</label>
                        <input
                          type="date"
                          className="w-full h-8 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100 text-xs"
                          value={newCase.lastContactDate}
                          onChange={e => setNewCase({ ...newCase, lastContactDate: e.target.value })}
                        />
                      </div>
                    </div>
                    <button
                      onClick={addCase}
                      className="w-full mt-1 px-3 py-1.5 text-xs rounded-full bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold"
                    >
                      Add to Caseload
                    </button>
                  </div>
                  {message && (
                    <div className="text-[11px] text-slate-300 mt-1">
                      {message}
                    </div>
                  )}
                </div>
              </div>

              {/* Right: selected case details & activities */}
              <div className="space-y-4 lg:col-span-2">
                {selectedCase ? (
                  <>
                    <div className="bg-slate-950/70 border border-slate-800 rounded-2xl p-4 space-y-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="text-xs font-semibold text-slate-200 uppercase tracking-wide">
                            Participant Details
                          </div>
                          <div className="text-sm font-semibold text-slate-50">
                            {selectedCase.name || "(no name)"}{" "}
                            <span className="text-[11px] text-slate-400 ml-2">
                              SID: {selectedCase.sid || "—"}
                            </span>
                          </div>
                        </div>
                        <button
                          onClick={deleteSelectedCase}
                          className="px-3 py-1.5 text-[11px] rounded-full border border-slate-600 bg-slate-900 hover:bg-red-500/20 hover:border-red-500/70 text-slate-100"
                        >
                          Remove from Caseload
                        </button>
                      </div>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-2 text-[11px]">
                        <div>
                          <label className="text-slate-300">Enrollment date</label>
                          <input
                            type="date"
                            className="w-full h-7 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100"
                            value={selectedCase.enrollmentDate || ""}
                            onChange={e => updateSelectedCase("enrollmentDate", e.target.value)}
                          />
                        </div>
                        <div>
                          <label className="text-slate-300">Last contact date</label>
                          <input
                            type="date"
                            className="w-full h-7 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100"
                            value={selectedCase.lastContactDate || ""}
                            onChange={e => updateSelectedCase("lastContactDate", e.target.value)}
                          />
                        </div>
                        <div className="col-span-2">
                          {(() => {
                            const status = inactivityStatus(
                              selectedCase.lastContactDate,
                              selectedCase.enrollmentDate
                            );
                            return (
                              <div
                                className={`mt-4 inline-flex items-center px-3 py-1 rounded-full border text-[11px] ${status.color}`}
                              >
                                {status.label}
                              </div>
                            );
                          })()}
                        </div>
                      </div>
                    </div>

                    {/* Activities */}
                    <div className="bg-slate-950/70 border border-slate-800 rounded-2xl p-4 space-y-3">
                      <div className="flex items-center justify-between mb-1">
                        <div className="text-xs font-semibold text-slate-200 uppercase tracking-wide">
                          Activities & Key Dates
                        </div>
                        <span className="text-[11px] text-slate-400">
                          Total activities:{" "}
                          <span className="text-emerald-300 font-semibold">
                            {selectedCase.activities?.length || 0}
                          </span>
                        </span>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-4 gap-2 text-[11px]">
                        <input
                          className="md:col-span-2 h-8 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100"
                          placeholder="Activity name (e.g., Monthly contact, ISS update, WEX check-in)"
                          value={newActivity.label}
                          onChange={e => setNewActivity({ ...newActivity, label: e.target.value })}
                        />
                        <select
                          className="h-8 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100"
                          value={newActivity.status}
                          onChange={e => setNewActivity({ ...newActivity, status: e.target.value })}
                        >
                          {STATUS_OPTIONS.map(s => (
                            <option key={s.value} value={s.value}>
                              {s.label}
                            </option>
                          ))}
                        </select>
                        <input
                          type="date"
                          className="h-8 px-2 rounded-lg border border-slate-700 bg-slate-900 text-slate-100"
                          value={newActivity.date}
                          onChange={e => setNewActivity({ ...newActivity, date: e.target.value })}
                        />
                      </div>
                      <textarea
                        rows="2"
                        className="w-full mt-2 px-2 py-1.5 rounded-lg border border-slate-700 bg-slate-900 text-slate-100 text-[11px]"
                        placeholder="Notes / details"
                        value={newActivity.notes}
                        onChange={e => setNewActivity({ ...newActivity, notes: e.target.value })}
                      ></textarea>
                      <div className="flex justify-end mt-1">
                        <button
                          onClick={addActivity}
                          className="px-3 py-1.5 text-xs rounded-full bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold"
                        >
                          Add Activity
                        </button>
                      </div>

                      <div className="mt-3 max-h-64 overflow-auto space-y-2 text-xs">
                        {(selectedCase.activities || []).length === 0 && (
                          <div className="text-[11px] text-slate-500">
                            No activities recorded yet. Add monthly contacts, ISS updates, training, etc.
                          </div>
                        )}
                        {selectedCase.activities?.map(act => (
                          <div
                            key={act.id}
                            className="border border-slate-700 rounded-xl px-3 py-2 bg-slate-900 flex flex-col gap-1"
                          >
                            <div className="flex items-center justify-between gap-2">
                              <div>
                                <div className="font-semibold text-slate-100">
                                  {act.label}
                                </div>
                                <div className="text-[10px] text-slate-400">
                                  Date: {act.date || "—"}
                                </div>
                              </div>
                              <div className="flex items-center gap-2">
                                <div className="inline-flex items-center gap-1">
                                  {STATUS_OPTIONS.map(s => (
                                    <label
                                      key={s.value}
                                      className={`
                                        inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-[10px] cursor-pointer
                                        ${
                                          act.status === s.value
                                            ? s.color
                                            : "bg-slate-900 border-slate-600 text-slate-300 hover:border-emerald-400/70"
                                        }
                                      `}
                                    >
                                      <input
                                        type="checkbox"
                                        className="h-3 w-3 accent-emerald-500"
                                        checked={act.status === s.value}
                                        onChange={() => updateActivity(act.id, { status: s.value })}
                                      />
                                      <span>{s.label}</span>
                                    </label>
                                  ))}
                                </div>
                                <button
                                  onClick={() => deleteActivity(act.id)}
                                  className="text-slate-500 hover:text-red-400 text-xs"
                                >
                                  ×
                                </button>
                              </div>
                            </div>
                            {act.notes && (
                              <div className="text-[11px] text-slate-200 mt-1">
                                {act.notes}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  </>
                ) : (
                  <div className="bg-slate-950/70 border border-slate-800 rounded-2xl p-6 text-sm text-slate-300">
                    Select a participant from your caseload or add a new one to begin tracking activities and inactivity.
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>

